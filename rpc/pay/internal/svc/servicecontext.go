package svc

import (
	"github.com/smartwalle/alipay/v3"
	"github.com/zeromicro/go-zero/core/stores/sqlx"
	"zero-admin/rpc/model/paymodel"
	"zero-admin/rpc/pay/internal/config"
)

type ServiceContext struct {
	c                config.Config
	WxRecordModel    paymodel.PayWxRecordModel
	WxMerchantsModel paymodel.PayWxMerchantsModel
	AlipayClient     *alipay.Client
}

const (
	//kAppId      = "2021000122672643"
	//kPrivateKey = "MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCG/iWUj0IScEpQWeOxEdC8muaPNZdvmnXTeMXTLARMbOIlg3LsED1Nt4VqjZ/K2J+3jQGcGMtCGbIOTlJpBnjpM5n/IA+oiUmhooH6ftBJcDEpbixDAk9pvrW/LXE52V3+MMrpKKEwJMt+YOUKf//m4svx5aXgxzb7QlMk1F7TaYjxxbULcb2eZKhRfhfJwQYrt8DP8jRQq1Jo5m52tnvMrKQjyVJwJy44YTsEMrXRaPWZ0+XKMjUWTbnqdVECt9r2z/5M3r6x2j0qxiQAYBAGgeD/iazDtvhXCrrgb4nG7yEjOKhuVSN1mRItdmqW4TferOGCJZanxCFcdzrQkf2BAgMBAAECggEAcrbOIKyMrTaXMCjzAKnvBBduDgywn7pWnlpnYchp7rgohVBq/IfgUIa/7YhkXfAv6b79uzSmpYlIcjfEeFNztFiRaOhJ5iKkW6LJaaESRxX78QUav+barTXPJKLtMQeyhCvagsBwGYVrF/4nJQEY6Y+ZV/qbN6SS6Hm4RffijSxJKJv6CzUjkajxnDzJBz3ySR0z5L8Q0abRkb+PS8cgUO9VbiGcD4leQV3wXM1e3BFDBsQ7POVe2EAYWcGbDVHqV8hFM186zs2zsgMp4VzUODuPuBPaVbKnZcml3Z5aEIamJH52YtES3R5WvWWQ2We6xwmoGXmuGENHejtdqB21AQKBgQDE0Tu6yaP76lWxlq15TCeQORzVlWJ7zhcvoxEj4BTHTggs1r9dRLqLai9Cd2+cciirh+VeOFIUKSfX/yF+1iTYPO0qXVXtPVBkc8iVrRU1bDO7UCAWAMz36DteOSYsPL6roJrudmLuke1AQQz6I5ydRlupZpDYFsuxVNs2XhBtyQKBgQCvlbtCr8LEVpPP5Cye/KhBT3q8vORijFyz/U0Tq4IK4DRjKR2MSSrueR5Osq+qcAmqi7Fdn89XtjHQE1QFABLbHPE9F3f79M1/pndHABkOGXOHIxq8K+X9AshSRK1MoQp1pJLm2E4KiMxBSzaIvneug3ukPqeqm44SKG9uBuQN+QKBgQCE1peSzY+xcoseDo3NJZo6XGHawjWzS/kYPN5PsWk0z7Ty1opYYA/sEuIM4WHiXKaYh2NHAYpccx6iSV+JJO2/SPfltRNOyShedEs4wpZi9UHBNiZB046D8ClJwhbCmskyO3b2Zc8GKFXSHVWt6qVE/XzWTBSM1G3spVJDUp+SCQKBgQCpsNJmU4iuyWFW1BTPnixZ2h8rUn6CQ1bAWHfqH6GxMxdOEglNb9T+3a0Nr6EX3elpmlHSwsTW5uzjRBq6LmUKv8DhItJBfUgxKscxpgWQ28YL/0AyRVajG9JPt7GoUibSpTeXw8pAYg7Mt4y/wRvXW5jdlfPibS1znQJ72ksCuQKBgHOTEVs6M42vjXL/ijZPR1RBsY7rROKSsklpPjbyiHGrQeeJMWh4n1SNAVIrlaQmj3B8gCaCAFEJX702ajOEfnPrnDTO3V0w9rSP9S1PGoRr86JTOT8g3A+0d7Vp2BGnHZ/9s9Ed3cZzTev2TBZHdKeoTlYQfYaD7n/kttpI0Xx2"
	kAppId      = "2021003185602741"
	kPrivateKey = "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDOH8XY3tS13a1gmUVC0pwCydYyf4RynRiLCtxaLIdR1MCJOKGV0Lx2V5jZSSgQ32xYS07X3UVLY48Jfkxa/o3bgt3GCSIjyUnazIziV8wAhUEfL44ERCMTzTpSzT3+L03kgtIhfaR4fGpauLvvQhfNB1+MM2Vmb3nlnhR495B2aFUri1tZbGHWvaK4mW/Vulp2IyR7iekjpVx38G31bNeC9IHWCW1YIEX7KLlvwXm7ruhyWL+67WL8RWUw4ml3iUgpBma4ildlc3HbiHKP44z4j0OF467gBCobHoVnVzbDbcwNdg1zT4XdOJkHMQrq+kH8aIe6QgC2k40Nod2LrsM3AgMBAAECggEAc17hVHPUxz6ernTbiX1siTsDwxwQvD4l4J1hnK9Txn+4jJXAC6Tb97kr+mKyJE+JyxnLtZNKF9pP01Z30m6sY/MpwpCWJUWjKu5W5NGTg68SNixd5xFkOM8kF/h8/GrpxD9c8hXrGu04cjL4LgDmZYH8/vI9jUpUBium9dZLa5oU6Uvj9X87nsIw0vTS9fA7Bcy6Wx9+Ae4t2wSj8vVAYKqJ011ONT4su2OUdpqdoHOKTCZOD/zNFHWUoXgVJ8zDgPA2Cv8F7L1wEG6d9A5fdYZU6mPDAHbSEXqZFvisjTQF4YXYJyI5y3MTT+e9DLrJXLb1IsnW8yxQg1kRxRj+MQKBgQDrJrGxKWpmo5xeVpR556K5UKYBdBiF8ejYklN/DqNfkOYei8AqtNb+SvAy35j6yVMhpArW2Dna2D4+FdcESwOuECU1Atp+N7DiS8DJqeaWjifpMYveTr/SXu4jRtObT5ElEccuZHXxswh/RHmRXmwfTx4r7hC0WriL69nwSApKIwKBgQDgZj3/p8kGj7oxEj0yfNSVXaggMlmqUDR4VN3/apiXzDz2KzVNuv91GJvn/L4Jw3dS9VN9yQp0Gj0pbeSdt8BiEpnD6MPX7JhxymJLp9TvWoyTQh+VPscRWAXvBSFq3cidgktFTldfukSnt/KpxR0FU7+7E0lrT2V0Ova4Mgzh3QKBgDXacb1yD7Ub6TbNu0lD3Ed2id4xWWBrq3jV4htqHc5IH/uE4+ij68znGqV8AcwFiW1d5UGY2X8eIPsVA14vU9NsTSkb0zAuzuq0kJ1etLlsKwXD3BV4kYO7S+x2TwX1rfcAYE5moYBOETccVn8NUdPFydIjvl2fnT4mMI5P4VNjAoGBAKTPsx2AGA9vpKrB4JyiPmht3zu2f1Ctk7wFaP9dRTHIWcXbukya2WEhb/CVGuaE37DYajfqXnkjhGRXSB/mg7AERVc0MBL4vIZmxIcYfzZE5RaK7DNrZj4Azmrc88xPlDbLKYl/noC6iA4+9kVmdoghGKLH6ZadO8CARhDHAdspAoGASAXW67OEycBYMttks2U4uST99C41MEVvL/4Nh3hpKsToIz/qQgx8B8dps0SgsLw/dFIQEMC+pLdnQ74VnclXm5eOuYD3z1stCyOOlkHl8pKqDY58eS9VJucWQlP0uoPEdLv4MLb/c++/BJvePe2PHs3ItbRrOEXsm1yZkumcU1Y="

	kServerPort = "9989"
	// TODO 设置回调地址域名
	kServerDomain = ""
)

func NewServiceContext(c config.Config) *ServiceContext {
	sqlConn := sqlx.NewMysql(c.Mysql.Datasource)
	client, err := alipay.New(kAppId, kPrivateKey, true)
	if err != nil {
		panic("初始化支付宝失败")
	}
	return &ServiceContext{
		c:                c,
		WxRecordModel:    paymodel.NewPayWxRecordModel(sqlConn),
		WxMerchantsModel: paymodel.NewPayWxMerchantsModel(sqlConn),
		AlipayClient:     client,
	}
}
